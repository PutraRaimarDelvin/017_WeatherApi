<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Weather App Dinamis</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h2>üå§Ô∏è Cari Cuaca Lokasi</h2>

    <!-- ‚è∞ Jam realtime -->
    <div id="clock" class="clock" aria-live="polite"></div>

    <!-- STEP 1: Ketik Provinsi -->
    <div class="autocomplete" id="provinsi-wrap">
        <input type="text" id="provinsiInput" placeholder="Ketik nama provinsi (mis. DI Yogyakarta)" autocomplete="off" />
        <button id="btnCari" type="button">Cari</button>
        <div id="provSuggestions" class="suggestions hidden"></div>
    </div>

    <!-- STEP 2: Pilih Kab/Kota (muncul setelah pilih provinsi) -->
    <div class="picker single" id="kabWrap" hidden>
        <select id="kabkota" disabled>
            <option value="">Pilih Kabupaten/Kota</option>
        </select>
    </div>

    <div class="result" id="result"></div>
</div>

<script>
    // ===== STATE =====
    let selectedProv = null;

// ===== CLOCK (Jam real-time) =====
const clockEl = document.getElementById("clock");

function getTZLabel(){
    const minutesAhead = -new Date().getTimezoneOffset();
    if (minutesAhead === 420) return "WIB";
    if (minutesAhead === 480) return "WITA";
    if (minutesAhead === 540) return "WIT";
    const sign = minutesAhead >= 0 ? "+" : "-";
    return `UTC${sign}${Math.abs(minutesAhead/60)}`;
}

function updateClock(){
    const now = new Date();
    const opts = {
        weekday: "long", year: "numeric", month: "long", day: "numeric",
        hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false
    };
    const t = now.toLocaleString("id-ID", opts);
    clockEl.textContent = `${t} ${getTZLabel()}`;
}
updateClock();
setInterval(updateClock, 1000);

// ===== UTIL =====
function debounce(fn, d=300){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), d); }; }
const fetchJSON = (url)=>fetch(url).then(r=>r.json());

// ===== Load daftar provinsi =====
const WIL_API = "https://www.emsifa.com/api-wilayah-indonesia/api";
let provinsiList = [];
async function loadProvinsi(){
    provinsiList = await fetchJSON(`${WIL_API}/provinces.json`);
}
loadProvinsi();

// ===== Autocomplete Provinsi =====
const provInput = document.getElementById("provinsiInput");
const provSug   = document.getElementById("provSuggestions");

function renderProvSuggestions(items){
    if(!items.length){
        provSug.innerHTML = '<div class="suggestion-item muted">Provinsi tidak ditemukan</div>';
        provSug.classList.remove("hidden");
        return;
    }
    provSug.innerHTML = items.map((p)=>`
        <div class="suggestion-item" data-id="${p.id}" data-name="${p.name}">
            <div class="title">${p.name}</div>
            <div class="sub">Provinsi</div>
        </div>`).join("");
    provSug.classList.remove("hidden");
}

const handleProvInput = debounce((q)=>{
    selectedProv = null;
    if(!q || q.trim().length<2){ provSug.classList.add("hidden"); return; }
    const term = q.toLowerCase();
    const filtered = provinsiList
        .filter(p => p.name.toLowerCase().includes(term))
        .slice(0, 10);
    renderProvSuggestions(filtered);
}, 250);

provInput.addEventListener("input", e => handleProvInput(e.target.value));

provSug.addEventListener("click", async (e)=>{
    const item = e.target.closest(".suggestion-item"); if(!item) return;
    const id = item.getAttribute("data-id");
    const name = item.getAttribute("data-name");
    selectedProv = { id, name };
    provInput.value = name;
    provSug.classList.add("hidden");
});


</script>
</body>
</html> 
